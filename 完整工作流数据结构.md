# å®Œæ•´å·¥ä½œæµæ•°æ®ç»“æ„

## ğŸ“‹ æ•°æ®ç»“æ„è¯´æ˜

æœ¬æ–‡æ¡£æä¾›ä¸€ä¸ªå®Œæ•´çš„å·¥ä½œæµæ•°æ®ç»“æ„ï¼Œå±•ç¤ºä¸€ä¸ªè¿è´¯çš„å¤šçº§å®¡æ ¸åœºæ™¯ï¼š
**å®Œæ•´ä¸šåŠ¡æµç¨‹**ï¼šæ§åˆ¶ä»·åˆæ­¥æˆæœæ–‡ä»¶æäº¤â†’ä¸€å®¡é€šè¿‡â†’äºŒå®¡é©³å›â†’å½“å¤©é‡æ–°æäº¤â†’äºŒå®¡é€šè¿‡â†’ä¸‰å®¡æ¬¡æ—¥é©³å›â†’é‡æ–°æäº¤â†’ä¸‰å®¡é€šè¿‡â†’ç”Ÿæˆæœ€ç»ˆæ–‡ä»¶åŒ…

è¿™ä¸ªåœºæ™¯èƒ½å¤Ÿå…¨é¢æµ‹è¯•ï¼š
- å¤šçº§å®¡æ ¸æµç¨‹çš„å®Œæ•´æ€§
- åŒä¸€å¤©å¤šæ¬¡æ“ä½œçš„å…¼å®¹æ€§  
- è·¨æ—¶é—´ç‚¹è¿æ¥çº¿çš„æ­£ç¡®æ€§
- å¤æ‚è·¯å¾„ä¸‹åŠ¨ç”»èŠ‚ç‚¹çš„è¡¨ç°
- é©³å›å’Œé‡æ–°æäº¤çš„é€»è¾‘å¤„ç†

## ğŸ—ï¸ å®Œæ•´æ—¶é—´ç‚¹æ•°æ®ç»“æ„

```typescript
const timePoints: TimePoint[] = [
  // ç¬¬ä¸€å¤©ï¼šæ§åˆ¶ä»·åˆæ­¥æˆæœæ–‡ä»¶æäº¤ + ä¸€å®¡é€šè¿‡
  {
    id: "tp_20240115",
    date: "2024-01-15",
    label: "1æœˆ15æ—¥",
    isInterval: false,
    displayWidth: 200,
    hasNodes: true,
    nodeCount: 2,
    isEndPoint: false
  },
  
  // ç¬¬äºŒå¤©ï¼šäºŒå®¡é©³å› + é‡æ–°æäº¤ + äºŒå®¡é€šè¿‡ + æäº¤ä¸‰å®¡
  {
    id: "tp_20240116",
    date: "2024-01-16", 
    label: "1æœˆ16æ—¥",
    isInterval: false,
    displayWidth: 400,
    hasNodes: true,
    nodeCount: 4,
    isEndPoint: false
  },
  
  // ç¬¬ä¸‰å¤©ï¼šä¸‰å®¡é©³å›
  {
    id: "tp_20240117",
    date: "2024-01-17",
    label: "1æœˆ17æ—¥", 
    isInterval: false,
    displayWidth: 150,
    hasNodes: true,
    nodeCount: 1,
    isEndPoint: false
  },
  
  // ç¬¬å››å¤©ï¼šé‡æ–°æäº¤ + ä¸‰å®¡é€šè¿‡
  {
    id: "tp_20240118",
    date: "2024-01-18",
    label: "1æœˆ18æ—¥",
    isInterval: false,
    displayWidth: 200,
    hasNodes: true,
    nodeCount: 2,
    isEndPoint: true
  }
]
```

## ğŸ¯ å®Œæ•´å·¥ä½œæµèŠ‚ç‚¹æ•°æ®ç»“æ„

```typescript
const workflowNodes: WorkflowNode[] = [
  // ========================================
  // ç¬¬ä¸€å¤© (2024-01-15)ï¼šæ§åˆ¶ä»·åˆæ­¥æˆæœæ–‡ä»¶æäº¤ + ä¸€å®¡é€šè¿‡
  // ========================================
  
  // èŠ‚ç‚¹1ï¼šæ§åˆ¶ä»·åˆæ­¥æˆæœæ–‡ä»¶æäº¤
  {
    id: "node_submit_001",
    reviewerId: "user_001",
    timePointId: "tp_20240115",
    fileId: "file_001",
    title: "æ§åˆ¶ä»·åˆæ­¥æˆæœæ–‡ä»¶",
    status: "completed",
    stateInfo: "å·²æäº¤",
    connections: [
      {
        id: "conn_001_002",
        fromNodeId: "node_submit_001",
        toNodeId: "node_first_approve",
        type: "forward",
        label: "æäº¤ä¸€å®¡",
        actionSequence: 1,
        actionTime: "09:00",
        status: "completed"
      }
    ],
    rightAction: [
      { label: "æŸ¥çœ‹è¯¦æƒ…", action: "view" }
    ],
    nodeType: "start",
    timeSequence: 1,
    positionInDay: 1,
    timeDetail: "09:00",
    isModified: true,
    lastModifiedTime: "2024-01-15T09:00:00Z",
    modificationCount: 1,
    hasBeenVisited: false,
    currentVisualState: "default"
  },
  
  // èŠ‚ç‚¹2ï¼šæ§åˆ¶ä»·ä¸€å®¡é€å®¡æ–‡ä»¶é€šè¿‡
  {
    id: "node_first_approve",
    reviewerId: "reviewer_A",
    timePointId: "tp_20240115",
    fileId: "file_002",
    title: "æ§åˆ¶ä»·ä¸€å®¡æˆæœæ–‡ä»¶",
    status: "approved",
    stateInfo: "ä¸€å®¡é€šè¿‡",
    connections: [
      {
        id: "conn_002_003",
        fromNodeId: "node_first_approve",
        toNodeId: "node_second_reject",
        type: "forward",
        label: "æäº¤äºŒå®¡",
        actionSequence: 2,
        actionTime: "14:30",
        status: "completed"
      }
    ],
    rightAction: [
      { label: "æŸ¥çœ‹ä¸€å®¡æ„è§", action: "view_opinion" }
    ],
    nodeType: "milestone",
    timeSequence: 2,
    positionInDay: 2,
    timeDetail: "14:30",
    isModified: true,
    lastModifiedTime: "2024-01-15T14:30:00Z",
    modificationCount: 1,
    hasBeenVisited: false,
    currentVisualState: "default"
  },

  // ========================================
  // ç¬¬äºŒå¤© (2024-01-16)ï¼šäºŒå®¡é©³å› + é‡æ–°æäº¤ + äºŒå®¡é€šè¿‡ + æäº¤ä¸‰å®¡
  // ========================================
  
  // èŠ‚ç‚¹3ï¼šæ§åˆ¶ä»·äºŒå®¡é€å®¡æ–‡ä»¶é©³å›
  {
    id: "node_second_reject",
    reviewerId: "reviewer_B",
    timePointId: "tp_20240116",
    fileId: "file_003",
    title: "æ§åˆ¶ä»·äºŒå®¡é€å®¡æ–‡ä»¶",
    status: "rejected",
    stateInfo: "é©³å›ï¼šææ–™éœ€è¦è¡¥å……",
    connections: [
      {
        id: "conn_003_004",
        fromNodeId: "node_second_reject",
        toNodeId: "node_resubmit_001",
        type: "reject",
        label: "é©³å›å¤„ç†",
        actionSequence: 1,
        actionTime: "10:00",
        status: "completed"
      }
    ],
    rightAction: [
      { label: "æŸ¥çœ‹é©³å›åŸå› ", action: "view_reason" },
      { label: "é‡æ–°å®¡æ ¸", action: "re_review" }
    ],
    nodeType: "normal",
    canContinueAfterReject: true,
    timeSequence: 1,
    positionInDay: 1,
    timeDetail: "10:00",
    isModified: true,
    lastModifiedTime: "2024-01-16T10:00:00Z",
    modificationCount: 1,
    hasBeenVisited: false,
    currentVisualState: "default"
  },
  
  // èŠ‚ç‚¹4ï¼šé‡æ–°æäº¤äºŒå®¡æ–‡ä»¶
  {
    id: "node_resubmit_001",
    reviewerId: "user_001",
    timePointId: "tp_20240116",
    fileId: "file_004",
    title: "æ§åˆ¶ä»·äºŒå®¡é€å®¡æ–‡ä»¶ï¼ˆä¿®è®¢ç‰ˆï¼‰",
    status: "completed",
    stateInfo: "å·²é‡æ–°æäº¤",
    connections: [
      {
        id: "conn_004_005",
        fromNodeId: "node_resubmit_001",
        toNodeId: "node_second_approve",
        type: "reprocess",
        label: "é‡æ–°äºŒå®¡",
        actionSequence: 2,
        actionTime: "13:30",
        status: "completed"
      }
    ],
    rightAction: [
      { label: "æŸ¥çœ‹ä¿®æ”¹å†…å®¹", action: "view_changes" }
    ],
    nodeType: "normal",
    timeSequence: 2,
    positionInDay: 2,
    timeDetail: "13:30",
    isModified: true,
    lastModifiedTime: "2024-01-16T13:30:00Z",
    modificationCount: 2,
    hasBeenVisited: false,
    currentVisualState: "default"
  },
  
  // èŠ‚ç‚¹5ï¼šæ§åˆ¶ä»·äºŒå®¡æˆæœæ–‡ä»¶
  {
    id: "node_second_approve",
    reviewerId: "reviewer_B",
    timePointId: "tp_20240116",
    fileId: "file_005",
    title: "æ§åˆ¶ä»·äºŒå®¡æˆæœæ–‡ä»¶",
    status: "approved",
    stateInfo: "äºŒå®¡é€šè¿‡",
    connections: [
      {
        id: "conn_005_006",
        fromNodeId: "node_second_approve",
        toNodeId: "node_third_reject",
        type: "forward",
        label: "æäº¤ä¸‰å®¡",
        actionSequence: 3,
        actionTime: "15:00",
        status: "completed"
      }
    ],
    rightAction: [
      { label: "æŸ¥çœ‹äºŒå®¡æ„è§", action: "view_opinion" }
    ],
    nodeType: "milestone",
    timeSequence: 3,
    positionInDay: 3,
    timeDetail: "15:00",
    isModified: true,
    lastModifiedTime: "2024-01-16T15:00:00Z",
    modificationCount: 1,
    hasBeenVisited: false,
    currentVisualState: "default"
  },

  // ========================================
  // ç¬¬ä¸‰å¤© (2024-01-17)ï¼šä¸‰å®¡é©³å›
  // ========================================
  
  // èŠ‚ç‚¹6ï¼šæ§åˆ¶ä»·ä¸‰å®¡é€å®¡æ–‡ä»¶é©³å›
  {
    id: "node_third_reject",
    reviewerId: "reviewer_C",
    timePointId: "tp_20240117",
    fileId: "file_006",
    title: "æ§åˆ¶ä»·ä¸‰å®¡é€å®¡æ–‡ä»¶",
    status: "rejected",
    stateInfo: "é©³å›ï¼šæ ¼å¼éœ€è¦è°ƒæ•´",
    connections: [
      {
        id: "conn_006_007",
        fromNodeId: "node_third_reject",
        toNodeId: "node_resubmit_002",
        type: "reject",
        label: "è·¨æ—¥é©³å›",
        actionSequence: 1,
        actionTime: "11:20",
        status: "completed"
      }
    ],
    rightAction: [
      { label: "æŸ¥çœ‹é©³å›åŸå› ", action: "view_reason" },
      { label: "é‡æ–°å®¡æ ¸", action: "re_review" }
    ],
    nodeType: "normal",
    canContinueAfterReject: true,
    timeSequence: 1,
    positionInDay: 1,
    timeDetail: "11:20",
    isModified: true,
    lastModifiedTime: "2024-01-17T11:20:00Z",
    modificationCount: 1,
    hasBeenVisited: false,
    currentVisualState: "default"
  },

  // ========================================
  // ç¬¬å››å¤© (2024-01-18)ï¼šé‡æ–°æäº¤ + ä¸‰å®¡é€šè¿‡ + ç”Ÿæˆæœ€ç»ˆæ–‡ä»¶åŒ…
  // ========================================
  
  // èŠ‚ç‚¹7ï¼šé‡æ–°æäº¤ä¸‰å®¡æ–‡ä»¶
  {
    id: "node_resubmit_002",
    reviewerId: "user_001",
    timePointId: "tp_20240118",
    fileId: "file_007",
    title: "æ§åˆ¶ä»·ä¸‰å®¡é€å®¡æ–‡ä»¶ï¼ˆä¿®è®¢ç‰ˆï¼‰",
    status: "completed",
    stateInfo: "å·²é‡æ–°æäº¤",
    connections: [
      {
        id: "conn_007_008",
        fromNodeId: "node_resubmit_002",
        toNodeId: "node_third_approve",
        type: "reprocess",
        label: "é‡æ–°ä¸‰å®¡",
        actionSequence: 1,
        actionTime: "09:30",
        status: "completed"
      }
    ],
    rightAction: [
      { label: "æŸ¥çœ‹ä¿®æ”¹å†…å®¹", action: "view_changes" }
    ],
    nodeType: "normal",
    timeSequence: 1,
    positionInDay: 1,
    timeDetail: "09:30",
    isModified: true,
    lastModifiedTime: "2024-01-18T09:30:00Z",
    modificationCount: 3,
    hasBeenVisited: false,
    currentVisualState: "default"
  },
  
  // èŠ‚ç‚¹8ï¼šæ§åˆ¶ä»·æœ€ç»ˆæ–‡ä»¶åŒ…
  {
    id: "node_third_approve",
    reviewerId: "reviewer_C",
    timePointId: "tp_20240118",
    fileId: "file_008",
    title: "æ§åˆ¶ä»·æœ€ç»ˆæ–‡ä»¶åŒ…",
    status: "approved",
    stateInfo: "ä¸‰å®¡é€šè¿‡",
    connections: [],
    rightAction: [
      { label: "æŸ¥çœ‹ç»ˆå®¡ç»“æœ", action: "view_final_result" },
      { label: "ä¸‹è½½æœ€ç»ˆæ–‡ä»¶åŒ…", action: "download_final_package" }
    ],
    nodeType: "end",
    isWorkflowEnd: true,
    endType: "success",
    finalResult: "æ§åˆ¶ä»·å®¡æ ¸å®Œæˆï¼Œå·²ç”Ÿæˆæœ€ç»ˆæ–‡ä»¶åŒ…",
    timeSequence: 2,
    positionInDay: 2,
    timeDetail: "16:45",
    isModified: true,
    lastModifiedTime: "2024-01-18T16:45:00Z",
    modificationCount: 1,
    hasBeenVisited: false,
    currentVisualState: "default"
  }
]
```

## ğŸ® å®Œæ•´åŠ¨ç”»è·¯å¾„é…ç½®

```typescript
const animationPaths = {
  // å®Œæ•´è¿è´¯åœºæ™¯
  complete: [
    "node_submit_001",        // æ§åˆ¶ä»·åˆæ­¥æˆæœæ–‡ä»¶
    "node_first_approve",     // æ§åˆ¶ä»·ä¸€å®¡æˆæœæ–‡ä»¶
    "node_second_reject",     // æ§åˆ¶ä»·äºŒå®¡é€å®¡æ–‡ä»¶ï¼ˆé©³å›ï¼‰
    "node_resubmit_001",      // æ§åˆ¶ä»·äºŒå®¡é€å®¡æ–‡ä»¶ï¼ˆä¿®è®¢ç‰ˆï¼‰
    "node_second_approve",    // æ§åˆ¶ä»·äºŒå®¡æˆæœæ–‡ä»¶
    "node_third_reject",      // æ§åˆ¶ä»·ä¸‰å®¡é€å®¡æ–‡ä»¶ï¼ˆé©³å›ï¼‰
    "node_resubmit_002",      // æ§åˆ¶ä»·ä¸‰å®¡é€å®¡æ–‡ä»¶ï¼ˆä¿®è®¢ç‰ˆï¼‰
    "node_third_approve"      // æ§åˆ¶ä»·æœ€ç»ˆæ–‡ä»¶åŒ…
  ],
  
  // åˆ†æ®µæ’­æ”¾ï¼šç¬¬ä¸€é˜¶æ®µï¼ˆä¸€å®¡ï¼‰
  phase1: [
    "node_submit_001",        // æ§åˆ¶ä»·åˆæ­¥æˆæœæ–‡ä»¶
    "node_first_approve"      // æ§åˆ¶ä»·ä¸€å®¡æˆæœæ–‡ä»¶
  ],
  
  // åˆ†æ®µæ’­æ”¾ï¼šç¬¬äºŒé˜¶æ®µï¼ˆäºŒå®¡ï¼‰
  phase2: [
    "node_first_approve",     // æ§åˆ¶ä»·ä¸€å®¡æˆæœæ–‡ä»¶
    "node_second_reject",     // æ§åˆ¶ä»·äºŒå®¡é€å®¡æ–‡ä»¶ï¼ˆé©³å›ï¼‰
    "node_resubmit_001",      // æ§åˆ¶ä»·äºŒå®¡é€å®¡æ–‡ä»¶ï¼ˆä¿®è®¢ç‰ˆï¼‰
    "node_second_approve"     // æ§åˆ¶ä»·äºŒå®¡æˆæœæ–‡ä»¶
  ],
  
  // åˆ†æ®µæ’­æ”¾ï¼šç¬¬ä¸‰é˜¶æ®µï¼ˆä¸‰å®¡ï¼‰
  phase3: [
    "node_second_approve",    // æ§åˆ¶ä»·äºŒå®¡æˆæœæ–‡ä»¶
    "node_third_reject",      // æ§åˆ¶ä»·ä¸‰å®¡é€å®¡æ–‡ä»¶ï¼ˆé©³å›ï¼‰
    "node_resubmit_002",      // æ§åˆ¶ä»·ä¸‰å®¡é€å®¡æ–‡ä»¶ï¼ˆä¿®è®¢ç‰ˆï¼‰
    "node_third_approve"      // æ§åˆ¶ä»·æœ€ç»ˆæ–‡ä»¶åŒ…
  ],
  
  // åªæ’­æ”¾é©³å›å’Œé‡æ–°æäº¤çš„éƒ¨åˆ†
  rejectFlow: [
    "node_second_reject",     // æ§åˆ¶ä»·äºŒå®¡é€å®¡æ–‡ä»¶ï¼ˆé©³å›ï¼‰
    "node_resubmit_001",      // æ§åˆ¶ä»·äºŒå®¡é€å®¡æ–‡ä»¶ï¼ˆä¿®è®¢ç‰ˆï¼‰
    "node_second_approve",    // æ§åˆ¶ä»·äºŒå®¡æˆæœæ–‡ä»¶
    "node_third_reject",      // æ§åˆ¶ä»·ä¸‰å®¡é€å®¡æ–‡ä»¶ï¼ˆé©³å›ï¼‰
    "node_resubmit_002",      // æ§åˆ¶ä»·ä¸‰å®¡é€å®¡æ–‡ä»¶ï¼ˆä¿®è®¢ç‰ˆï¼‰
    "node_third_approve"      // æ§åˆ¶ä»·æœ€ç»ˆæ–‡ä»¶åŒ…
  ]
}
```

## ğŸ® åŠ¨ç”»è·¯å¾„è‡ªåŠ¨è®¡ç®—ç®—æ³•

### ğŸ“Š è·¯å¾„è®¡ç®—æ ¸å¿ƒé€»è¾‘

ç”±äºåç«¯æ¥å£ä¸è¿”å›åŠ¨ç”»è·¯å¾„ï¼Œéœ€è¦å‰ç«¯æ ¹æ®å·¥ä½œæµèŠ‚ç‚¹æ•°æ®ç»“æ„è‡ªåŠ¨è®¡ç®—ç”ŸæˆåŠ¨ç”»è·¯å¾„ã€‚ä»¥ä¸‹æ˜¯å®Œæ•´çš„è®¡ç®—ç®—æ³•ï¼š

```typescript
/**
 * åŠ¨ç”»è·¯å¾„è®¡ç®—å™¨
 * æ ¹æ®å·¥ä½œæµèŠ‚ç‚¹æ•°æ®è‡ªåŠ¨ç”Ÿæˆå„ç§åŠ¨ç”»è·¯å¾„
 */
class AnimationPathCalculator {
  private nodes: WorkflowNode[]
  private timePoints: TimePoint[]
  
  constructor(nodes: WorkflowNode[], timePoints: TimePoint[]) {
    this.nodes = nodes
    this.timePoints = timePoints
  }

  /**
   * è®¡ç®—å®Œæ•´åŠ¨ç”»è·¯å¾„
   * @returns å®Œæ•´çš„èŠ‚ç‚¹IDåºåˆ—
   */
  calculateCompletePath(): string[] {
    // 1. æ‰¾åˆ°èµ·å§‹èŠ‚ç‚¹
    const startNode = this.findStartNode()
    if (!startNode) return []

    // 2. æ„å»ºå®Œæ•´è·¯å¾„
    const path: string[] = []
    const visited = new Set<string>()
    
    this.buildPath(startNode.id, path, visited)
    
    return path
  }

  /**
   * é€’å½’æ„å»ºè·¯å¾„
   * @param nodeId å½“å‰èŠ‚ç‚¹ID
   * @param path è·¯å¾„æ•°ç»„
   * @param visited å·²è®¿é—®èŠ‚ç‚¹é›†åˆ
   */
  private buildPath(nodeId: string, path: string[], visited: Set<string>) {
    if (visited.has(nodeId)) return
    
    visited.add(nodeId)
    path.push(nodeId)
    
    const currentNode = this.nodes.find(n => n.id === nodeId)
    if (!currentNode || currentNode.connections.length === 0) return
    
    // æŒ‰æ—¶é—´é¡ºåºå¤„ç†è¿æ¥
    const sortedConnections = currentNode.connections.sort((a, b) => {
      return this.compareConnectionTime(a, b)
    })
    
    for (const connection of sortedConnections) {
      if (connection.status === 'completed') {
        this.buildPath(connection.toNodeId, path, visited)
      }
    }
  }

  /**
   * è®¡ç®—åˆ†é˜¶æ®µè·¯å¾„
   * @returns å„é˜¶æ®µçš„è·¯å¾„å¯¹è±¡
   */
  calculatePhasePaths(): Record<string, string[]> {
    const phases: Record<string, string[]> = {}
    
    // æŒ‰æ—¶é—´ç‚¹åˆ†ç»„èŠ‚ç‚¹
    const nodesByTimePoint = this.groupNodesByTimePoint()
    
    // è®¡ç®—ä¸€å®¡é˜¶æ®µ
    phases.phase1 = this.calculatePhaseByReviewLevel(1)
    
    // è®¡ç®—äºŒå®¡é˜¶æ®µ
    phases.phase2 = this.calculatePhaseByReviewLevel(2)
    
    // è®¡ç®—ä¸‰å®¡é˜¶æ®µ
    phases.phase3 = this.calculatePhaseByReviewLevel(3)
    
    return phases
  }

  /**
   * æ ¹æ®å®¡æ ¸çº§åˆ«è®¡ç®—é˜¶æ®µè·¯å¾„
   * @param reviewLevel å®¡æ ¸çº§åˆ« (1=ä¸€å®¡, 2=äºŒå®¡, 3=ä¸‰å®¡)
   * @returns è¯¥é˜¶æ®µçš„èŠ‚ç‚¹è·¯å¾„
   */
  private calculatePhaseByReviewLevel(reviewLevel: number): string[] {
    const phaseNodes: string[] = []
    
    // æ ¹æ®èŠ‚ç‚¹æ ‡é¢˜å’ŒçŠ¶æ€åˆ¤æ–­å®¡æ ¸çº§åˆ«
    for (const node of this.nodes) {
      const isPhaseNode = this.isNodeInPhase(node, reviewLevel)
      if (isPhaseNode) {
        phaseNodes.push(node.id)
      }
    }
    
    // æŒ‰æ—¶é—´é¡ºåºæ’åº
    return this.sortNodesByTime(phaseNodes)
  }

  /**
   * åˆ¤æ–­èŠ‚ç‚¹æ˜¯å¦å±äºæŒ‡å®šå®¡æ ¸é˜¶æ®µ
   * @param node å·¥ä½œæµèŠ‚ç‚¹
   * @param reviewLevel å®¡æ ¸çº§åˆ«
   * @returns æ˜¯å¦å±äºè¯¥é˜¶æ®µ
   */
  private isNodeInPhase(node: WorkflowNode, reviewLevel: number): boolean {
    const title = node.title.toLowerCase()
    
    switch (reviewLevel) {
      case 1:
        return title.includes('åˆæ­¥æˆæœ') || title.includes('ä¸€å®¡')
      case 2:
        return title.includes('äºŒå®¡')
      case 3:
        return title.includes('ä¸‰å®¡') || title.includes('æœ€ç»ˆæ–‡ä»¶åŒ…')
      default:
        return false
    }
  }

  /**
   * è®¡ç®—é©³å›æµç¨‹è·¯å¾„
   * @returns åªåŒ…å«é©³å›å’Œé‡æ–°æäº¤çš„è·¯å¾„
   */
  calculateRejectFlowPath(): string[] {
    const rejectNodes: string[] = []
    
    for (const node of this.nodes) {
      // é©³å›èŠ‚ç‚¹
      if (node.status === 'rejected') {
        rejectNodes.push(node.id)
        
        // æ‰¾åˆ°å¯¹åº”çš„é‡æ–°æäº¤èŠ‚ç‚¹
        const resubmitNode = this.findResubmitNode(node)
        if (resubmitNode) {
          rejectNodes.push(resubmitNode.id)
          
          // æ‰¾åˆ°é‡æ–°æäº¤åçš„é€šè¿‡èŠ‚ç‚¹
          const approveNode = this.findApproveAfterResubmit(resubmitNode)
          if (approveNode) {
            rejectNodes.push(approveNode.id)
          }
        }
      }
    }
    
    return this.sortNodesByTime(rejectNodes)
  }

  /**
   * è®¡ç®—åŒæ—¥æ“ä½œè·¯å¾„
   * @param timePointId æ—¶é—´ç‚¹ID
   * @returns è¯¥æ—¶é—´ç‚¹çš„æ‰€æœ‰èŠ‚ç‚¹è·¯å¾„
   */
  calculateSameDayPath(timePointId: string): string[] {
    const sameDayNodes = this.nodes
      .filter(node => node.timePointId === timePointId)
      .map(node => node.id)
    
    return this.sortNodesByTime(sameDayNodes)
  }

  /**
   * è®¡ç®—è·¨æ—¥è¿æ¥è·¯å¾„
   * @returns æ‰€æœ‰è·¨æ—¥è¿æ¥çš„è·¯å¾„é›†åˆ
   */
  calculateCrossDayPaths(): Array<{from: string, to: string, path: string[]}> {
    const crossDayPaths: Array<{from: string, to: string, path: string[]}> = []
    
    for (const node of this.nodes) {
      for (const connection of node.connections) {
        const toNode = this.nodes.find(n => n.id === connection.toNodeId)
        
        if (toNode && node.timePointId !== toNode.timePointId) {
          crossDayPaths.push({
            from: node.id,
            to: toNode.id,
            path: [node.id, toNode.id]
          })
        }
      }
    }
    
    return crossDayPaths
  }

  /**
   * ç”Ÿæˆæ‰€æœ‰åŠ¨ç”»è·¯å¾„é…ç½®
   * @returns å®Œæ•´çš„åŠ¨ç”»è·¯å¾„é…ç½®å¯¹è±¡
   */
  generateAllAnimationPaths(): Record<string, string[]> {
    return {
      // å®Œæ•´è¿è´¯åœºæ™¯
      complete: this.calculateCompletePath(),
      
      // åˆ†é˜¶æ®µè·¯å¾„
      ...this.calculatePhasePaths(),
      
      // é©³å›æµç¨‹è·¯å¾„
      rejectFlow: this.calculateRejectFlowPath(),
      
      // åŒæ—¥æ“ä½œè·¯å¾„
      sameDay_20240115: this.calculateSameDayPath("tp_20240115"),
      sameDay_20240116: this.calculateSameDayPath("tp_20240116"),
      sameDay_20240117: this.calculateSameDayPath("tp_20240117"),
      sameDay_20240118: this.calculateSameDayPath("tp_20240118"),
      
      // è‡ªå®šä¹‰è·¯å¾„ï¼šåªçœ‹é€šè¿‡çš„èŠ‚ç‚¹
      approvedOnly: this.calculateApprovedOnlyPath(),
      
      // è‡ªå®šä¹‰è·¯å¾„ï¼šåªçœ‹é©³å›çš„èŠ‚ç‚¹
      rejectedOnly: this.calculateRejectedOnlyPath()
    }
  }

  // ========================================
  // è¾…åŠ©æ–¹æ³•
  // ========================================

  /**
   * æ‰¾åˆ°èµ·å§‹èŠ‚ç‚¹
   */
  private findStartNode(): WorkflowNode | undefined {
    return this.nodes.find(node => node.nodeType === 'start')
  }

  /**
   * æ‰¾åˆ°ç»“æŸèŠ‚ç‚¹
   */
  private findEndNode(): WorkflowNode | undefined {
    return this.nodes.find(node => node.nodeType === 'end')
  }

  /**
   * æŒ‰æ—¶é—´ç‚¹åˆ†ç»„èŠ‚ç‚¹
   */
  private groupNodesByTimePoint(): Record<string, WorkflowNode[]> {
    const groups: Record<string, WorkflowNode[]> = {}
    
    for (const node of this.nodes) {
      if (!groups[node.timePointId]) {
        groups[node.timePointId] = []
      }
      groups[node.timePointId].push(node)
    }
    
    return groups
  }

  /**
   * æŒ‰æ—¶é—´æ’åºèŠ‚ç‚¹IDæ•°ç»„
   */
  private sortNodesByTime(nodeIds: string[]): string[] {
    const nodesWithTime = nodeIds.map(id => {
      const node = this.nodes.find(n => n.id === id)
      return { id, node }
    }).filter(item => item.node)

    nodesWithTime.sort((a, b) => {
      // é¦–å…ˆæŒ‰æ—¶é—´ç‚¹æ’åº
      const timePointA = this.timePoints.find(tp => tp.id === a.node!.timePointId)
      const timePointB = this.timePoints.find(tp => tp.id === b.node!.timePointId)
      
      if (timePointA && timePointB) {
        const dateCompare = new Date(timePointA.date).getTime() - new Date(timePointB.date).getTime()
        if (dateCompare !== 0) return dateCompare
      }
      
      // åŒä¸€å¤©å†…æŒ‰æ—¶é—´åºåˆ—æ’åº
      return a.node!.timeSequence - b.node!.timeSequence
    })

    return nodesWithTime.map(item => item.id)
  }

  /**
   * æ¯”è¾ƒè¿æ¥æ—¶é—´
   */
  private compareConnectionTime(a: Connection, b: Connection): number {
    const timeA = new Date(`2024-01-01T${a.actionTime}:00`).getTime()
    const timeB = new Date(`2024-01-01T${b.actionTime}:00`).getTime()
    return timeA - timeB
  }

  /**
   * æ‰¾åˆ°é‡æ–°æäº¤èŠ‚ç‚¹
   */
  private findResubmitNode(rejectNode: WorkflowNode): WorkflowNode | undefined {
    for (const connection of rejectNode.connections) {
      if (connection.type === 'reject') {
        return this.nodes.find(n => n.id === connection.toNodeId)
      }
    }
    return undefined
  }

  /**
   * æ‰¾åˆ°é‡æ–°æäº¤åçš„é€šè¿‡èŠ‚ç‚¹
   */
  private findApproveAfterResubmit(resubmitNode: WorkflowNode): WorkflowNode | undefined {
    for (const connection of resubmitNode.connections) {
      if (connection.type === 'reprocess') {
        return this.nodes.find(n => n.id === connection.toNodeId)
      }
    }
    return undefined
  }

  /**
   * è®¡ç®—åªåŒ…å«é€šè¿‡èŠ‚ç‚¹çš„è·¯å¾„
   */
  private calculateApprovedOnlyPath(): string[] {
    return this.nodes
      .filter(node => node.status === 'approved' || node.status === 'completed')
      .map(node => node.id)
      .sort((a, b) => this.sortNodesByTime([a, b]).indexOf(a) - this.sortNodesByTime([a, b]).indexOf(b))
  }

  /**
   * è®¡ç®—åªåŒ…å«é©³å›èŠ‚ç‚¹çš„è·¯å¾„
   */
  private calculateRejectedOnlyPath(): string[] {
    return this.nodes
      .filter(node => node.status === 'rejected')
      .map(node => node.id)
      .sort((a, b) => this.sortNodesByTime([a, b]).indexOf(a) - this.sortNodesByTime([a, b]).indexOf(b))
  }
}
```

### ğŸ”§ è·¯å¾„è®¡ç®—ä½¿ç”¨ç¤ºä¾‹

```typescript
// åˆå§‹åŒ–è·¯å¾„è®¡ç®—å™¨
const pathCalculator = new AnimationPathCalculator(workflowNodes, timePoints)

// è‡ªåŠ¨ç”Ÿæˆæ‰€æœ‰åŠ¨ç”»è·¯å¾„
const animationPaths = pathCalculator.generateAllAnimationPaths()

console.log('ç”Ÿæˆçš„åŠ¨ç”»è·¯å¾„ï¼š', animationPaths)

// è¾“å‡ºç»“æœç¤ºä¾‹ï¼š
// {
//   complete: [
//     "node_submit_001",        // æ§åˆ¶ä»·åˆæ­¥æˆæœæ–‡ä»¶
//     "node_first_approve",     // æ§åˆ¶ä»·ä¸€å®¡æˆæœæ–‡ä»¶
//     "node_second_reject",     // æ§åˆ¶ä»·äºŒå®¡é€å®¡æ–‡ä»¶ï¼ˆé©³å›ï¼‰
//     "node_resubmit_001",      // æ§åˆ¶ä»·äºŒå®¡é€å®¡æ–‡ä»¶ï¼ˆä¿®è®¢ç‰ˆï¼‰
//     "node_second_approve",    // æ§åˆ¶ä»·äºŒå®¡æˆæœæ–‡ä»¶
//     "node_third_reject",      // æ§åˆ¶ä»·ä¸‰å®¡é€å®¡æ–‡ä»¶ï¼ˆé©³å›ï¼‰
//     "node_resubmit_002",      // æ§åˆ¶ä»·ä¸‰å®¡é€å®¡æ–‡ä»¶ï¼ˆä¿®è®¢ç‰ˆï¼‰
//     "node_third_approve"      // æ§åˆ¶ä»·æœ€ç»ˆæ–‡ä»¶åŒ…
//   ],
//   phase1: ["node_submit_001", "node_first_approve"],
//   phase2: ["node_first_approve", "node_second_reject", "node_resubmit_001", "node_second_approve"],
//   phase3: ["node_second_approve", "node_third_reject", "node_resubmit_002", "node_third_approve"],
//   rejectFlow: ["node_second_reject", "node_resubmit_001", "node_second_approve", "node_third_reject", "node_resubmit_002", "node_third_approve"],
//   sameDay_20240116: ["node_second_reject", "node_resubmit_001", "node_second_approve"],
//   approvedOnly: ["node_submit_001", "node_first_approve", "node_second_approve", "node_third_approve"],
//   rejectedOnly: ["node_second_reject", "node_third_reject"]
// }
```

### ğŸ¯ è·¯å¾„éªŒè¯å’Œä¼˜åŒ–

```typescript
/**
 * è·¯å¾„éªŒè¯å™¨
 * ç¡®ä¿ç”Ÿæˆçš„åŠ¨ç”»è·¯å¾„çš„æ­£ç¡®æ€§
 */
class PathValidator {
  static validatePath(path: string[], nodes: WorkflowNode[]): {
    isValid: boolean
    errors: string[]
    warnings: string[]
  } {
    const errors: string[] = []
    const warnings: string[] = []

    // 1. æ£€æŸ¥è·¯å¾„æ˜¯å¦ä¸ºç©º
    if (path.length === 0) {
      errors.push('åŠ¨ç”»è·¯å¾„ä¸ºç©º')
      return { isValid: false, errors, warnings }
    }

    // 2. æ£€æŸ¥æ‰€æœ‰èŠ‚ç‚¹æ˜¯å¦å­˜åœ¨
    for (const nodeId of path) {
      const node = nodes.find(n => n.id === nodeId)
      if (!node) {
        errors.push(`èŠ‚ç‚¹ ${nodeId} ä¸å­˜åœ¨`)
      }
    }

    // 3. æ£€æŸ¥è·¯å¾„è¿ç»­æ€§
    for (let i = 0; i < path.length - 1; i++) {
      const currentNode = nodes.find(n => n.id === path[i])
      const nextNode = nodes.find(n => n.id === path[i + 1])
      
      if (currentNode && nextNode) {
        const hasConnection = currentNode.connections.some(
          conn => conn.toNodeId === nextNode.id
        )
        
        if (!hasConnection) {
          warnings.push(`èŠ‚ç‚¹ ${currentNode.id} åˆ° ${nextNode.id} ç¼ºå°‘ç›´æ¥è¿æ¥`)
        }
      }
    }

    // 4. æ£€æŸ¥æ—¶é—´é¡ºåº
    for (let i = 0; i < path.length - 1; i++) {
      const currentNode = nodes.find(n => n.id === path[i])
      const nextNode = nodes.find(n => n.id === path[i + 1])
      
      if (currentNode && nextNode) {
        const currentTime = new Date(currentNode.lastModifiedTime).getTime()
        const nextTime = new Date(nextNode.lastModifiedTime).getTime()
        
        if (currentTime > nextTime) {
          warnings.push(`æ—¶é—´é¡ºåºå¼‚å¸¸ï¼š${currentNode.id} æ™šäº ${nextNode.id}`)
        }
      }
    }

    return {
      isValid: errors.length === 0,
      errors,
      warnings
    }
  }
}
```

### ğŸš€ å®Œæ•´é›†æˆç¤ºä¾‹

```typescript
// å®Œæ•´çš„åŠ¨ç”»è·¯å¾„ç®¡ç†ç³»ç»Ÿ
class WorkflowAnimationManager {
  private pathCalculator: AnimationPathCalculator
  private animationPaths: Record<string, string[]>
  
  constructor(nodes: WorkflowNode[], timePoints: TimePoint[]) {
    this.pathCalculator = new AnimationPathCalculator(nodes, timePoints)
    this.animationPaths = this.pathCalculator.generateAllAnimationPaths()
    
    // éªŒè¯æ‰€æœ‰è·¯å¾„
    this.validateAllPaths(nodes)
  }

  /**
   * è·å–æŒ‡å®šç±»å‹çš„åŠ¨ç”»è·¯å¾„
   */
  getAnimationPath(type: string): string[] {
    return this.animationPaths[type] || []
  }

  /**
   * è·å–æ‰€æœ‰å¯ç”¨çš„è·¯å¾„ç±»å‹
   */
  getAvailablePathTypes(): string[] {
    return Object.keys(this.animationPaths)
  }

  /**
   * åŠ¨æ€è®¡ç®—è‡ªå®šä¹‰è·¯å¾„
   */
  calculateCustomPath(filter: (node: WorkflowNode) => boolean): string[] {
    const filteredNodes = this.pathCalculator['nodes'].filter(filter)
    return this.pathCalculator['sortNodesByTime'](filteredNodes.map(n => n.id))
  }

  /**
   * éªŒè¯æ‰€æœ‰è·¯å¾„
   */
  private validateAllPaths(nodes: WorkflowNode[]) {
    for (const [pathType, path] of Object.entries(this.animationPaths)) {
      const validation = PathValidator.validatePath(path, nodes)
      
      if (!validation.isValid) {
        console.error(`è·¯å¾„ ${pathType} éªŒè¯å¤±è´¥:`, validation.errors)
      }
      
      if (validation.warnings.length > 0) {
        console.warn(`è·¯å¾„ ${pathType} è­¦å‘Š:`, validation.warnings)
      }
    }
  }
}

// ä½¿ç”¨ç¤ºä¾‹
const animationManager = new WorkflowAnimationManager(workflowNodes, timePoints)

// è·å–å®Œæ•´è·¯å¾„
const completePath = animationManager.getAnimationPath('complete')

// è·å–é©³å›æµç¨‹è·¯å¾„
const rejectPath = animationManager.getAnimationPath('rejectFlow')

// è‡ªå®šä¹‰è·¯å¾„ï¼šåªçœ‹åŒ…å«"æˆæœæ–‡ä»¶"çš„èŠ‚ç‚¹
const resultFilesPath = animationManager.calculateCustomPath(
  node => node.title.includes('æˆæœæ–‡ä»¶')
)

console.log('æˆæœæ–‡ä»¶è·¯å¾„ï¼š', resultFilesPath)
```

è¿™å¥—ç®—æ³•å¯ä»¥æ ¹æ®å·¥ä½œæµèŠ‚ç‚¹æ•°æ®ç»“æ„è‡ªåŠ¨è®¡ç®—å‡ºå„ç§ç±»å‹çš„åŠ¨ç”»è·¯å¾„ï¼Œæ— éœ€åç«¯è¿”å›ï¼Œå®Œå…¨ç”±å‰ç«¯è‡ªä¸»è®¡ç®—ç”Ÿæˆï¼

## ğŸ‘¥ å®¡æ ¸äººå‘˜æ•°æ®ç»“æ„

```typescript
const reviewers = [
  {
    id: "user_001",
    name: "å¼ ä¸‰",
    role: "ç”³è¯·äºº",
    position: 1,
    avatar: "/avatars/user_001.jpg",
    department: "äº§å“éƒ¨"
  },
  {
    id: "reviewer_A",
    name: "æå››",
    role: "ä¸€çº§å®¡æ ¸å‘˜",
    position: 2,
    avatar: "/avatars/reviewer_A.jpg",
    department: "å®¡æ ¸éƒ¨"
  },
  {
    id: "reviewer_B",
    name: "ç‹äº”",
    role: "äºŒçº§å®¡æ ¸å‘˜",
    position: 3,
    avatar: "/avatars/reviewer_B.jpg",
    department: "å®¡æ ¸éƒ¨"
  },
  {
    id: "reviewer_C",
    name: "èµµå…­",
    role: "ä¸‰çº§å®¡æ ¸å‘˜",
    position: 4,
    avatar: "/avatars/reviewer_C.jpg",
    department: "ç®¡ç†å±‚"
  }
]
```

## ğŸ“ æ–‡ä»¶æ•°æ®ç»“æ„

```typescript
const files = [
  {
    id: "file_001",
    name: "æ§åˆ¶ä»·åˆæ­¥æˆæœæ–‡ä»¶.pdf",
    size: "2.8MB",
    uploadTime: "2024-01-15T09:00:00Z",
    type: "application/pdf",
    status: "submitted",
    version: "v1.0",
    description: "æ§åˆ¶ä»·åˆæ­¥æˆæœæ–‡ä»¶ï¼Œå¾…ä¸€å®¡"
  },
  {
    id: "file_002",
    name: "æ§åˆ¶ä»·ä¸€å®¡æˆæœæ–‡ä»¶.pdf",
    size: "3.1MB",
    uploadTime: "2024-01-15T14:30:00Z",
    type: "application/pdf",
    status: "approved",
    version: "v1.1",
    description: "ä¸€å®¡é€šè¿‡åçš„æˆæœæ–‡ä»¶"
  },
  {
    id: "file_003",
    name: "æ§åˆ¶ä»·äºŒå®¡é€å®¡æ–‡ä»¶.pdf",
    size: "3.2MB",
    uploadTime: "2024-01-16T09:30:00Z",
    type: "application/pdf",
    status: "rejected",
    version: "v2.0",
    description: "äºŒå®¡é€å®¡æ–‡ä»¶ï¼Œè¢«é©³å›"
  },
  {
    id: "file_004",
    name: "æ§åˆ¶ä»·äºŒå®¡é€å®¡æ–‡ä»¶ï¼ˆä¿®è®¢ç‰ˆï¼‰.pdf",
    size: "3.4MB",
    uploadTime: "2024-01-16T13:30:00Z",
    type: "application/pdf",
    status: "resubmitted",
    version: "v2.1",
    description: "æ ¹æ®äºŒå®¡æ„è§ä¿®è®¢åé‡æ–°æäº¤"
  },
  {
    id: "file_005",
    name: "æ§åˆ¶ä»·äºŒå®¡æˆæœæ–‡ä»¶.pdf",
    size: "3.5MB",
    uploadTime: "2024-01-16T15:00:00Z",
    type: "application/pdf",
    status: "approved",
    version: "v2.2",
    description: "äºŒå®¡é€šè¿‡åçš„æˆæœæ–‡ä»¶"
  },
  {
    id: "file_006",
    name: "æ§åˆ¶ä»·ä¸‰å®¡é€å®¡æ–‡ä»¶.pdf",
    size: "3.6MB",
    uploadTime: "2024-01-17T10:00:00Z",
    type: "application/pdf",
    status: "rejected",
    version: "v3.0",
    description: "ä¸‰å®¡é€å®¡æ–‡ä»¶ï¼Œè¢«é©³å›"
  },
  {
    id: "file_007",
    name: "æ§åˆ¶ä»·ä¸‰å®¡é€å®¡æ–‡ä»¶ï¼ˆä¿®è®¢ç‰ˆï¼‰.pdf",
    size: "3.8MB",
    uploadTime: "2024-01-18T09:30:00Z",
    type: "application/pdf",
    status: "resubmitted",
    version: "v3.1",
    description: "æ ¹æ®ä¸‰å®¡æ„è§ä¿®è®¢åé‡æ–°æäº¤"
  },
  {
    id: "file_008",
    name: "æ§åˆ¶ä»·æœ€ç»ˆæ–‡ä»¶åŒ….zip",
    size: "15.2MB",
    uploadTime: "2024-01-18T16:45:00Z",
    type: "application/zip",
    status: "final",
    version: "v3.2",
    description: "åŒ…å«æ‰€æœ‰å®¡æ ¸é˜¶æ®µæˆæœçš„æœ€ç»ˆæ–‡ä»¶åŒ…",
    contents: [
      "æ§åˆ¶ä»·åˆæ­¥æˆæœæ–‡ä»¶.pdf",
      "æ§åˆ¶ä»·ä¸€å®¡æˆæœæ–‡ä»¶.pdf", 
      "æ§åˆ¶ä»·äºŒå®¡æˆæœæ–‡ä»¶.pdf",
      "æ§åˆ¶ä»·ä¸‰å®¡æˆæœæ–‡ä»¶.pdf",
      "å®¡æ ¸æ„è§æ±‡æ€».pdf",
      "ä¿®è®¢è®°å½•.xlsx"
    ]
  }
]
```

## ğŸ”„ è¿æ¥çº¿å¸ƒå±€åˆ†æ

### åŒä¸€å¤©å†…çš„è¿æ¥ï¼ˆå‚ç›´çº¿ï¼‰
- **1æœˆ15æ—¥**ï¼šæäº¤ â†’ ä¸€å®¡é€šè¿‡ï¼ˆå‚ç›´çº¿ï¼‰
- **1æœˆ16æ—¥**ï¼šäºŒå®¡é©³å› â†’ é‡æ–°æäº¤ â†’ äºŒå®¡é€šè¿‡ï¼ˆå‚ç›´çº¿ç»„åˆï¼‰
- **1æœˆ18æ—¥**ï¼šé‡æ–°æäº¤ â†’ ä¸‰å®¡é€šè¿‡ï¼ˆå‚ç›´çº¿ï¼‰

### è·¨æ—¶é—´ç‚¹çš„è¿æ¥ï¼ˆæ°´å¹³çº¿ï¼‰
- **1æœˆ15æ—¥ â†’ 1æœˆ16æ—¥**ï¼šä¸€å®¡é€šè¿‡ â†’ äºŒå®¡é©³å›ï¼ˆæ°´å¹³çº¿ï¼‰
- **1æœˆ16æ—¥ â†’ 1æœˆ17æ—¥**ï¼šäºŒå®¡é€šè¿‡ â†’ ä¸‰å®¡é©³å›ï¼ˆæ°´å¹³çº¿ï¼‰
- **1æœˆ17æ—¥ â†’ 1æœˆ18æ—¥**ï¼šä¸‰å®¡é©³å› â†’ é‡æ–°æäº¤ï¼ˆæ°´å¹³çº¿ï¼‰

### å¤æ‚è¿æ¥çº¿å¤„ç†
```typescript
// è¿æ¥çº¿æ ·å¼é…ç½®
const connectionStyles = {
  // åŒæ—¥æ“ä½œï¼šå‚ç›´çº¿
  sameDay: {
    type: "vertical",
    style: "solid",
    color: "#1890ff"
  },
  
  // è·¨æ—¥æ“ä½œï¼šæ°´å¹³çº¿
  crossDay: {
    type: "horizontal", 
    style: "solid",
    color: "#52c41a"
  },
  
  // é©³å›æ“ä½œï¼šç‰¹æ®Šæ ·å¼
  reject: {
    type: "mixed",
    style: "dashed",
    color: "#ff4d4f"
  },
  
  // é‡æ–°å¤„ç†ï¼šç‰¹æ®Šæ ·å¼
  reprocess: {
    type: "mixed",
    style: "dotted",
    color: "#fa8c16"
  }
}
```

## ğŸ¨ åŠ¨ç”»èŠ‚ç‚¹çŠ¶æ€ç®¡ç†

### å¤æ‚åœºæ™¯ä¸‹çš„çŠ¶æ€å˜åŒ–
```typescript
// åŠ¨ç”»èŠ‚ç‚¹çŠ¶æ€ç®¡ç†
class ComplexAnimationController {
  constructor(nodes: WorkflowNode[], path: string[]) {
    this.nodes = nodes
    this.animationPath = path
    this.currentIndex = 0
    this.isPlaying = false
  }
  
  // å¤„ç†åŒä¸€å¤©å¤šä¸ªèŠ‚ç‚¹çš„åŠ¨ç”»
  handleSameDayNodes(timePointId: string) {
    const sameDayNodes = this.nodes.filter(n => n.timePointId === timePointId)
    
    // æŒ‰æ—¶é—´é¡ºåºæ’åº
    sameDayNodes.sort((a, b) => {
      return new Date(`2024-01-01T${a.timeDetail}:00`).getTime() - 
             new Date(`2024-01-01T${b.timeDetail}:00`).getTime()
    })
    
    // ä¾æ¬¡æ’­æ”¾åŠ¨ç”»
    sameDayNodes.forEach((node, index) => {
      setTimeout(() => {
        this.animateNode(node.id)
      }, index * 800) // æ¯ä¸ªèŠ‚ç‚¹é—´éš”800ms
    })
  }
  
  // å¤„ç†è·¨æ—¥è¿æ¥çš„åŠ¨ç”»
  handleCrossDayConnection(fromNodeId: string, toNodeId: string) {
    const fromNode = this.nodes.find(n => n.id === fromNodeId)
    const toNode = this.nodes.find(n => n.id === toNodeId)
    
    if (fromNode && toNode && fromNode.timePointId !== toNode.timePointId) {
      // ç»˜åˆ¶è·¨æ—¥è¿æ¥çº¿åŠ¨ç”»
      this.animateCrossDayLine(fromNode, toNode)
    }
  }
  
  // å¤„ç†é©³å›èŠ‚ç‚¹çš„ç‰¹æ®ŠåŠ¨ç”»
  handleRejectNode(nodeId: string) {
    const node = this.nodes.find(n => n.id === nodeId)
    if (node && node.status === 'rejected') {
      // é©³å›èŠ‚ç‚¹çš„ç‰¹æ®ŠåŠ¨ç”»æ•ˆæœ
      this.animateRejectEffect(node)
    }
  }
}
```

## ğŸš€ ä½¿ç”¨ç¤ºä¾‹

### å®Œæ•´åœºæ™¯æµ‹è¯•
```typescript
// åˆå§‹åŒ–å®Œæ•´å·¥ä½œæµç³»ç»Ÿ
const workflowConfig = {
  timePoints,
  workflowNodes,
  animationPaths,
  reviewers,
  files
}

// æµ‹è¯•å®Œæ•´è¿è´¯åœºæ™¯
const completeSceneTest = () => {
  const controller = new ComplexAnimationController(
    workflowNodes, 
    animationPaths.complete
  )
  
  // æ’­æ”¾å®Œæ•´æµç¨‹
  controller.play()
  
  // æµ‹è¯•åŒä¸€å¤©å¤šæ¬¡æ“ä½œ
  controller.handleSameDayNodes("tp_20240116")
  
  // æµ‹è¯•è·¨æ—¥è¿æ¥
  controller.handleCrossDayConnection("node_first_approve", "node_second_reject")
  
  // æµ‹è¯•é©³å›å¤„ç†
  controller.handleRejectNode("node_second_reject")
  controller.handleRejectNode("node_third_reject")
}

// åˆ†é˜¶æ®µæµ‹è¯•
const phaseTest = () => {
  // æµ‹è¯•ä¸€å®¡é˜¶æ®µ
  const phase1Controller = new ComplexAnimationController(
    workflowNodes,
    animationPaths.phase1
  )
  phase1Controller.play()
  
  // æµ‹è¯•äºŒå®¡é˜¶æ®µï¼ˆåŒ…å«é©³å›é‡æ–°æäº¤ï¼‰
  setTimeout(() => {
    const phase2Controller = new ComplexAnimationController(
      workflowNodes,
      animationPaths.phase2
    )
    phase2Controller.play()
  }, 3000)
  
  // æµ‹è¯•ä¸‰å®¡é˜¶æ®µï¼ˆåŒ…å«é©³å›é‡æ–°æäº¤ï¼‰
  setTimeout(() => {
    const phase3Controller = new ComplexAnimationController(
      workflowNodes,
      animationPaths.phase3
    )
    phase3Controller.play()
  }, 6000)
}

// æ‰§è¡Œæµ‹è¯•
completeSceneTest()
```

## ğŸ“Š åœºæ™¯æµ‹è¯•ä»·å€¼åˆ†æ

### ğŸ¯ æµ‹è¯•è¦†ç›–èŒƒå›´
1. **å¤šçº§å®¡æ ¸æµç¨‹**ï¼šä¸€å®¡â†’äºŒå®¡â†’ä¸‰å®¡çš„å®Œæ•´é“¾è·¯
2. **é©³å›é‡æ–°æäº¤**ï¼šäºŒå®¡é©³å›ã€ä¸‰å®¡é©³å›çš„å¤„ç†é€»è¾‘
3. **åŒæ—¥å¤šæ¬¡æ“ä½œ**ï¼š1æœˆ16æ—¥çš„4ä¸ªè¿ç»­æ“ä½œ
4. **è·¨æ—¥è¿æ¥**ï¼š3æ¡è·¨æ—¶é—´ç‚¹çš„è¿æ¥çº¿
5. **å¤æ‚åŠ¨ç”»è·¯å¾„**ï¼š8ä¸ªèŠ‚ç‚¹çš„å®Œæ•´åŠ¨ç”»åºåˆ—

### ğŸ”§ å…¼å®¹æ€§æµ‹è¯•
1. **æ—¶é—´ç‚¹å¸ƒå±€**ï¼šä¸åŒå®½åº¦æ—¶é—´ç‚¹çš„è‡ªé€‚åº”
2. **èŠ‚ç‚¹å¯†åº¦**ï¼šåŒä¸€å¤©4ä¸ªèŠ‚ç‚¹çš„å¸ƒå±€å¤„ç†
3. **è¿æ¥çº¿äº¤å‰**ï¼šå¤šæ¡è¿æ¥çº¿çš„è§†è§‰å¤„ç†
4. **çŠ¶æ€ç®¡ç†**ï¼šå¤æ‚çŠ¶æ€å˜åŒ–çš„æ­£ç¡®æ€§

### ğŸ¨ ç”¨æˆ·ä½“éªŒæµ‹è¯•
1. **åŠ¨ç”»æµç•…æ€§**ï¼šé•¿è·¯å¾„åŠ¨ç”»çš„æ€§èƒ½è¡¨ç°
2. **è§†è§‰åé¦ˆ**ï¼šé©³å›èŠ‚ç‚¹çš„ç‰¹æ®Šæ•ˆæœ
3. **äº¤äº’å“åº”**ï¼šé‡æ–°å¼€å§‹åŠŸèƒ½çš„å®Œæ•´æ€§
4. **ä¿¡æ¯å±•ç¤º**ï¼šå¤æ‚æµç¨‹çš„æ¸…æ™°åº¦

è¿™ä¸ªè¿è´¯çš„å¤šçº§å®¡æ ¸åœºæ™¯å®Œç¾åœ°æ¶µç›–äº†ä½ æåˆ°çš„æ‰€æœ‰æµ‹è¯•éœ€æ±‚ï¼Œèƒ½å¤Ÿå…¨é¢éªŒè¯ç³»ç»Ÿçš„å„é¡¹åŠŸèƒ½ï¼ 